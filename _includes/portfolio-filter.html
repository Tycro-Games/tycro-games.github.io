<script>
document.addEventListener('DOMContentLoaded', function () {
  const filterButtons = document.querySelectorAll('.filter-btn');
  const projectCards = document.querySelectorAll('.portfolio-page > .projects-container .project-card-link');
  const articleCards = document.querySelectorAll('.articles-section .project-card-link');
  const articlesSection = document.querySelector('.articles-section');
  const projectCount = document.getElementById('project-count');
  const articleCount = document.getElementById('article-count');
  
  function updateCounts(filter) {
    const totalProjects = projectCards.length;
    const totalArticles = articleCards.length;
    
    let visibleProjects, visibleArticles;
    
    if (filter === 'highlights') {
      visibleProjects = Array.from(projectCards).filter(c => 
        (parseInt(c.getAttribute('data-priority-highlights')) || 999) !== 999
      ).length;
      visibleArticles = Array.from(articleCards).filter(c => 
        c.getAttribute('data-pinned') === 'true'
      ).length;
    } else {
      visibleProjects = totalProjects;
      visibleArticles = 0;
    }
    
    if (projectCount) {
      if (filter === 'highlights' && visibleProjects < totalProjects) {
        projectCount.textContent = `Showing ${visibleProjects} of ${totalProjects}`;
        projectCount.style.display = '';
      } else {
        projectCount.style.display = 'none';
      }
    }
    
    if (articleCount) {
      if (filter === 'highlights' && visibleArticles < totalArticles) {
        articleCount.textContent = `Showing ${visibleArticles} of ${totalArticles}`;
        articleCount.style.display = '';
      } else {
        articleCount.style.display = 'none';
      }
    }
  }
  
  function applyFilter(filter) {
    const cardsArray = Array.from(projectCards);
    
    if (filter === 'chronological') {
      cardsArray.sort((a, b) => {
        const dateA = parseInt(a.getAttribute('data-date'));
        const dateB = parseInt(b.getAttribute('data-date'));
        return dateB - dateA;
      });
      cardsArray.forEach((card, index) => {
        card.style.display = '';
        card.style.order = index;
      });
    } else {
      const priorityAttr = `data-priority-${filter}`;
      cardsArray.sort((a, b) => {
        const priorityA = parseInt(a.getAttribute(priorityAttr)) || 999;
        const priorityB = parseInt(b.getAttribute(priorityAttr)) || 999;
        return priorityA - priorityB;
      });
      cardsArray.forEach((card, index) => {
        const priority = parseInt(card.getAttribute(priorityAttr)) || 999;
        if (priority === 999) {
          card.style.display = 'none';
        } else {
          card.style.display = '';
          card.style.order = index;
        }
      });
    }
    
    if (articlesSection) {
      if (filter === 'highlights') {
        articlesSection.style.display = '';
        articleCards.forEach(card => {
          const isPinned = card.getAttribute('data-pinned') === 'true';
          card.style.display = isPinned ? '' : 'none';
        });
      } else {
        articlesSection.style.display = 'none';
      }
    }
    
    updateCounts(filter);
  }
  
  applyFilter('highlights');
  
  filterButtons.forEach((button) => {
    button.addEventListener('click', function () {
      filterButtons.forEach((btn) => btn.classList.remove('active'));
      this.classList.add('active');
      applyFilter(this.dataset.filter);
    });
  });
});
</script>